/**
@author Devless
@version 0.01
@description Devless sdk for Javascript	
*/
!function(e){"use strict"
function s(e,s,t,n){t=t||{}
var o="",r=function(e,s){for(var t in s)o="&"+e+"="+s[t]+o}
for(var a in t)!t.hasOwnProperty(a),t[a]instanceof Array?r(a,t[a]):o="&"+a+"="+t[a]+o
var i=u+e+"/db?table="+s+o
return l.call(this,"",i,"GET",function(e){n(e)}),this}function t(e,s,t,n){var o=JSON.stringify({resource:[{name:s,field:[t]}]}),r=u+e+"/db"
return l.call(this,o,r,"POST",function(e){n(e)}),this}function n(e,s,t,n,o,r){var a=JSON.stringify({resource:[{name:s,params:[{where:t+","+n,data:[o]}]}]}),i=u+e+"/db"
return l.call(this,a,i,"PATCH",function(e){r(e)}),this}function o(e,s,t,n,o){var r={resource:[{name:s,params:[{where:t+",=,"+n}]}]}
r.resource[0].params[0].delete="true"
var a=JSON.stringify(r),i=u+e+"/db"
return l.call(this,a,i,"DELETE",function(e){o(e)}),this}function r(e){var s=e||!1
return s?void e(sessionStorage.getItem("devless_user_token"+this.devless_instance_url+this.devless_token)):sessionStorage.getItem("devless_user_token"+this.devless_instance_url+this.devless_token)}function a(e){return sessionStorage.setItem("devless_user_token"+this.devless_instance_url+this.devless_token,e),!0}function i(e,s,t,n){var o=JSON.stringify({jsonrpc:"2.0",method:e,id:c(1,1e7),params:t}),r=u+e+"/rpc?action="+s
l.call(this,o,r,"POST",function(e){n(e)})}function c(e,s){return Math.floor(Math.random()*(s-e+1))+e}function l(e,s,t,n,o){o=o||!1
var r=new XMLHttpRequest
r.addEventListener("readystatechange",function(){var e=""
4===this.readyState&&0==o?200==this.status?(e=JSON.parse(this.responseText),n(e)):(n(e),console.error("Devless cannot be found at "+this.devless_instance_url+" Please copy the url from the `App tab`  on you Devless instance by clicking on  `connect to my app`")):4===this.readyState&&1==o&&(200==this.status?(e=this.responseText,n(e)):(n(e),console.error("Devless cannot be found at "+this.devless_instance_url+" Please copy the url from the `App tab`  on you Devless instance by clicking on  `connect to my app`")))}),r.open(t.toUpperCase(),this.devless_instance_url+s),r.setRequestHeader("content-type","application/json"),r.setRequestHeader("devless-token",this.devless_token),""!=sessionStorage.getItem("devless_user_token"+this.devless_instance_url+this.devless_token)&&r.setRequestHeader("devless-user-token",sessionStorage.getItem("devless_user_token"+this.devless_instance_url+this.devless_token)),r.send(e)}var u="/api/v1/service/",d=function(s){if(!s)return void console.error("Your app failed to  connect to Devless ): Please make sure token and key is set properly ")
console.info("App is trying to connect to Devless ...")
var t=u+"/dvauth/script",n={},o=new d.init(s)
return e.returnedInstance="",l.call(o,n,t,"POST",function(e){e=JSON.parse(e),631==e.status_code?console.error("Your app failed to  connect to Devless ): Please make sure token and key is set properly "):1e3==e.status_code?(console.debug("Your app connected to Devless successfully and you have auth service installed"),returnedInstance=o):(console.debug("your app connected to Devless successfully. you can get services from store.devless.io "),returnedInstance=o)},!0),o}
d.prototype={queryData:s,addData:t,updateData:n,deleteData:o,getToken:r,setToken:a,call:i},d.init=function(e){var s=this
s.devless_token=e.token,s.devless_instance_url=e.domain},d.init.prototype=d.prototype,e.Devless=e.DV=d}(window)
